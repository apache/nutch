# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

name: junit report
on:
  workflow_run:
    workflows: [master pull request ci]
    types: [completed]
permissions:
  checks: write
  pull-requests: write
jobs:
  checks:
    runs-on: ubuntu-latest
    steps:
      - name: Download Test Report
        uses: dawidd6/action-download-artifact@v11
        with:
          name: junit-test-results
          workflow: master-build.yml
          run_id: ${{ github.event.workflow_run.id }}
      - name: Publish Test Report
        uses: mikepenz/action-junit-report@v5
        with:
          report_paths: |-
            ./build/test/TEST-*.xml
            ./build/**/test/TEST-*.xml
          commit: ${{ github.event.workflow_run.head_sha }}
          comment: true
          pr_id: ${{ github.event.workflow_run.pull_requests[0].number }}
          fail_on_failure: true
          job_summary: true
          detailed_summary: true
          truncate_stack_traces: false
          fail_on_parse_error: false # temporary while debugging TestMimeUtil
          require_tests: true
          include_time_in_summary: true
          include_passed: true
          job_name: tests
          check_name: 'JUnit Test Report Core, JUnit Test Report Plugins'