<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><!--This page is automatically generated.  Do not edit!-->
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Nutch: tutorial</title>
<style type="text/css">
.menuTd {background-color: #F9F7F4; height: 25; onMouseOver: this.style.backgroundColor='#ECE5DC';}
.menuTdhover {background-color: #ECE5DC; height: 25; onMouseOver: this.style.backgroundColor='#ECE5DC';}
.menuEntry {  font-family: Arial, Helvetica, sans-serif; font-size: 12px; color: #000000; text-decoration: none}
.body {background-color: #F9F7F4;}
.bodytext {  font-family: Arial, Helvetica, sans-serif; font-size: 12px; color: #000000; text-decoration: none}
.title {  font-family: Arial, Helvetica, sans-serif; font-size: 26px; color: #FF9900; text-decoration: none}
.intro {  font-family: Arial, Helvetica, sans-serif; font-size: 12px; color: #FF9900; text-decoration: none}
.orangeTd {background-color: #FF9900}
ul {list-style-image: url(../img/reiter/ul.gif)}
h3 {font-family: Arial, Helvetica, sans-serif; font-size: 16px; color: #000000;}
h4 {font-family: Arial, Helvetica, sans-serif; font-size: 14px; color: #000000;}
.url {color: #996600;}
</style>
<link type="image/x-icon" href="../img/favicon.ico" rel="icon">
<link type="image/x-icon" href="../img/favicon.ico" rel="shortcut icon">
</head>
<body>
<!--This file is automatically generated.  Do not edit!-->
<table cellspacing="0" cellpadding="0" border="0" width="635">
<tr>
<td rowspan="2" width="140" valign="bottom"><a href="./"><img border="0" src="../img/reiter/logo_nutch.gif"></a><img height="1" width="140" src="../img/reiter/spacer_666666.gif"></td>
</tr>
<tr>
<td align="right" valign="bottom" width="495">
<table width="495" cellspacing="0" cellpadding="0" border="0">
<tr>
<td width="400" background="../img/reiter/_bg_reiter.gif">&nbsp;</td><td width="10" valign="bottom" height="28"><img border="0" src="../img/reiter/reiter_inactive_le1.gif"></td><td nowrap="nowrap" valign="bottom" background="../img/reiter/_bg_reiter_inactive.gif"><a href="about.html" class="bodytext">About</a></td><td width="10" valign="bottom" height="28"><img border="0" src="../img/reiter/reiter_inactive_ri.gif"></td><td width="10" valign="bottom" height="28"><img border="0" src="../img/reiter/reiter_inactive_le.gif"></td><td nowrap="nowrap" valign="bottom" background="../img/reiter/_bg_reiter_inactive.gif"><a href="faq.html" class="bodytext">FAQ</a></td><td width="10" valign="bottom" height="28"><img border="0" src="../img/reiter/reiter_inactive_ri.gif"></td><td width="10" valign="bottom" height="28"><img border="0" src="../img/reiter/reiter_inactive_le.gif"></td><td nowrap="nowrap" valign="bottom" background="../img/reiter/_bg_reiter_inactive.gif"><a href="developers.html" class="bodytext">Developers</a></td><td width="10" valign="bottom" height="28"><img border="0" src="../img/reiter/reiter_inactive_ri.gif"></td><td width="10" valign="bottom" height="28"><img border="0" src="../img/reiter/reiter_inactive_le.gif"></td><td nowrap="nowrap" valign="bottom" background="../img/reiter/_bg_reiter_inactive.gif"><a href="donate.html" class="bodytext">Donate</a></td><td width="10" valign="bottom" height="28"><img border="0" src="../img/reiter/reiter_inactive_ri.gif"></td>
</tr>
</table>
</td>
</tr>
</table>
<table cellspacing="0" cellpadding="0" border="0" width="635">
<tr valign="top">
<td width="140">
<table cellspacing="0" cellpadding="0" width="100%">
<tr>
<td>&#160;</td>
</tr>
</table>
</td><td background="../img/reiter/_spacer_cccccc.gif" width="20">&#160;</td><td class="body" width="475">
<table cellspacing="0" cellpadding="0" border="0" width="475">
<tr>
<td valign="bottom" width="275" height="125" class="title">tutorial</td><td valign="bottom" width="200" height="125"><img src="../img/reiter/robots.gif"></td>
</tr>
</table>
<br class="br">
<span class="bodytext">

</span><span class="bodytext">
<h3>Requirements</h3>
</span><span class="bodytext">
</span><span class="bodytext">
<ol>
  
<li>Java 1.4.x, either from <a href="http://java.sun.com/j2se/downloads.html">Sun</a> or <a href="http://www-106.ibm.com/developerworks/java/jdk/">IBM</a> on
 Linux is preferred.  Set <code>NUTCH_JAVA_HOME</code> to the root
 of your JVM installation.
  </li>
  
<li>Apache's <a href="http://jakarta.apache.org/tomcat/">Tomcat</a>
4.x.</li>
  
<li>On Win32, <a href="http://www.cygwin.com/">cygwin</a>, for
shell support.  (If you plan to use CVS on Win32, be sure to select the cvs and
openssh packages when you install, in the "Devel" and "Net"
categories, respectively.)</li>
  
<li>Up to a gigabyte of free disk space, a high-speed connection, and
an hour or so.
  </li>

</ol>
</span><span class="bodytext">
</span><span class="bodytext">
<h3>Getting Started</h3>
</span><span class="bodytext"> </span><span class="bodytext">
<p>First, you need to get a copy of the Nutch
code.  You can download a release from <a href="http://www.nutch.org/release/">http://www.nutch.org/release/</a>.
Unpack the release and connect to its top-level directory.  Or, check
out the latest source code from <a href="http://incubator.apache.org/nutch/version_control.html">Subversion</a> and build it
with <a href="http://ant.apache.org/">Ant</a>.</p>
</span><span class="bodytext">

</span><span class="bodytext">
<p>Try the following command:</p>
</span><span class="bodytext">
</span><span class="bodytext">
<pre style="margin-left: 40px;">bin/nutch</pre>
</span><span class="bodytext">
This will display the documentation for the Nutch command script.

</span><span class="bodytext">
<p>Now we're ready to crawl.  There are two approaches to crawling:
<ol>

<li>Intranet crawling, with the <code>crawl</code> command.</li>

<li>Whole-web crawling, with much greater control, using the lower
level <code>inject</code>, <code>generate</code>, <code>fetch</code>
and <code>updatedb</code> commands.</li>

</ol>

</p>
</span><span class="bodytext">

</span><span class="bodytext">
<h3>Intranet Crawling</h3>
</span><span class="bodytext">

</span><span class="bodytext">
<p>Intranet crawling is more appropriate when you intend to crawl up to
around one million pages on a handful of web servers.</p>
</span><span class="bodytext">

</span><span class="bodytext">
<h4>Intranet: Configuration</h4>
</span><span class="bodytext">

To configure things for intranet crawling you must:

</span><span class="bodytext">
<ol>


<li>Create a flat file of root urls.  For example, to crawl the
<code>nutch.org</code> site you might start with a file named
<code>urls</code> containing just the Nutch home page.  All other
Nutch pages should be reachable from this page.  The <code>urls</code>
file would thus look like:
<pre>
http://www.nutch.org/
</pre>

</li>


<li>Edit the file <code>conf/crawl-urlfilter.txt</code> and replace
<code>MY.DOMAIN.NAME</code> with the name of the domain you wish to
crawl.  For example, if you wished to limit the crawl to the
<code>nutch.org</code> domain, the line should read:
<pre>
+^http://([a-z0-9]*\.)*nutch.org/
</pre>
This will include any url in the domain <code>nutch.org</code>.
</li>


</ol>
</span><span class="bodytext">

</span><span class="bodytext">
<h4>Intranet: Running the Crawl</h4>
</span><span class="bodytext">

Once things are configured, running the crawl is easy.  Just use the
crawl command.  Its options include:

</span><span class="bodytext">
<ul>

<li>
<code>-dir</code> <i>dir</i> names the directory to put the crawl in.</li>

<li>
<code>-depth</code> <i>depth</i> indicates the link depth from the root
page that should be crawled.</li>

<li>
<code>-delay</code> <i>delay</i> determines the number of seconds
between accesses to each host.</li>

<li>
<code>-threads</code> <i>threads</i> determines the number of
threads that will fetch in parallel.</li>

</ul>
</span><span class="bodytext">

For example, a typical call might be:

</span><span class="bodytext">
<pre>
bin/nutch crawl urls -dir crawl.test -depth 3 &gt;&amp; crawl.log
</pre>
</span><span class="bodytext">

Typically one starts testing one's configuration by crawling at low
depths, and watching the output to check that desired pages are found.
Once one is more confident of the configuration, then an appropriate
depth for a full crawl is around 10.

</span><span class="bodytext">
<p>Once crawling has completed, one can skip to the Searching section
below.</p>
</span><span class="bodytext">

</span><span class="bodytext">
<h3>Whole-web Crawling</h3>
</span><span class="bodytext">

Whole-web crawling is designed to handle very large crawls which may
take weeks to complete, running on multiple machines.

</span><span class="bodytext">
<h4>Whole-web: Concepts</h4>
</span><span class="bodytext">
Nutch data is of two types:
</span><span class="bodytext">
<ol>
  
<li>The web database.  This contains information about every
page known to Nutch, and about links between those pages.</li>
  
<li>A set of segments.  Each segment is a set of pages that are
fetched and indexed as a unit.  Segment data consists of the
following types:</li>
  
<ul>
    
<li>a <i>fetchlist</i> is a file
that names a set of pages to be fetched</li>
    
<li>the<i> fetcher output</i> is a
set of files containing the fetched pages</li>
    
<li>the <i>index </i>is a
Lucene-format index of the fetcher output.</li>
  
</ul>

</ol>
</span><span class="bodytext">
In the following examples we will keep our web database in a directory
named </span><span class="bodytext"><tt>db</tt></span><span class="bodytext"> and our segments
in a directory named </span><span class="bodytext"><tt>segments</tt></span><span class="bodytext">:
</span><span class="bodytext">
<pre style="margin-left: 40px;">mkdir db
mkdir segments</pre>
</span><span class="bodytext">

</span><span class="bodytext">
<h4>Whole-web: Boostrapping the Web Database</h4>
</span><span class="bodytext">
The admin tool is used to create a new, empty database:
</span><span class="bodytext">
<pre style="margin-left: 40px;">bin/nutch admin db -create</pre>
</span><span class="bodytext">
The </span><span class="bodytext"><i>injector</i></span><span class="bodytext"> adds urls into
the database.  Let's inject URLs from the </span><span class="bodytext"><a href="http://dmoz.org/">DMOZ</a></span><span class="bodytext"> Open Directory. First we must download
and uncompress the file listing all of the DMOZ pages.  (This is a
200+Mb file, so this will take a few minutes.)
</span><span class="bodytext">
<pre style="margin-left: 40px;">wget http://rdf.dmoz.org/rdf/content.rdf.u8.gz
gunzip content.rdf.u8.gz</pre>
</span><span class="bodytext">
Next we inject a random subset of these pages into the web database.
 (We use a random subset so that everyone who runs this tutorial
doesn't hammer the same sites.)  DMOZ contains around three million
URLs.  We inject one out of every 3000, so that we end up with
around 1000 URLs:
</span><span class="bodytext">
<pre style="margin-left: 40px;">bin/nutch inject db -dmozfile content.rdf.u8 -subset 3000</pre>
</span><span class="bodytext">
This also takes a few minutes, as it must parse the full file.

</span><span class="bodytext">
<p>Now we have a web database with around 1000 as-yet unfetched URLs in it.</p>
</span><span class="bodytext">

</span><span class="bodytext">
<h4>Whole-web: Fetching</h4>
</span><span class="bodytext">
To fetch, we first generate a fetchlist from the database:
</span><span class="bodytext">
<pre style="margin-left: 40px;">bin/nutch generate db segments
</pre>
</span><span class="bodytext">
This generates a fetchlist for all of the pages due to be fetched.
 The fetchlist is placed in a newly created segment directory.
 The segment directory is named by the time it's created.  We
save the name of this segment in the shell variable </span><span class="bodytext"><tt>&gt;s1</tt></span><span class="bodytext">:
</span><span class="bodytext">
<pre style="margin-left: 40px;">s1=`ls -d segments/2* | tail -1`
echo $s1
</pre>
</span><span class="bodytext">
Now we run the fetcher on this segment with:
</span><span class="bodytext">
<pre style="margin-left: 40px;">bin/nutch fetch $s1</pre>
</span><span class="bodytext">
When this is complete, we update the database with the results of the
fetch:
</span><span class="bodytext">
<pre style="margin-left: 40px;">bin/nutch updatedb db $s1</pre>
</span><span class="bodytext">
Now the database has entries for all of the pages referenced by the
initial set.

</span><span class="bodytext">
<p>Next we run five iterations of link analysis on the database in order
to prioritize which pages to next fetch:</p>
</span><span class="bodytext">
</span><span class="bodytext">
<pre style="margin-left: 40px;">bin/nutch analyze db 5
</pre>
</span><span class="bodytext">
Now we fetch a new segment with the top-scoring 1000 pages:
</span><span class="bodytext">
<pre style="margin-left: 40px;">bin/nutch generate db segments -topN 1000
s2=`ls -d segments/2* | tail -1`
echo $s2

bin/nutch fetch $s2
bin/nutch updatedb db $s2
bin/nutch analyze db 2
</pre>
</span><span class="bodytext">
Let's fetch one more round:
</span><span class="bodytext">
<pre style="margin-left: 40px;">
bin/nutch generate db segments -topN 1000
s3=`ls -d segments/2* | tail -1`
echo $s3

bin/nutch fetch $s3
bin/nutch updatedb db $s3
bin/nutch analyze db 2</pre>
</span><span class="bodytext">
By this point we've fetched a few thousand pages.  Let's index
them!

</span><span class="bodytext">
<h4>Whole-web: Indexing</h4>
</span><span class="bodytext">
To index each segment we use the </span><span class="bodytext"><tt>index</tt></span><span class="bodytext">
command, as follows:
</span><span class="bodytext">
<pre style="margin-left: 40px;">bin/nutch index $s1
bin/nutch index $s2
bin/nutch index $s3</pre>
</span><span class="bodytext">
Then, before we can search a set of segments, we need to delete
duplicate pages.  This is done with:
</span><span class="bodytext">
<pre style="margin-left: 40px;">bin/nutch dedup segments dedup.tmp</pre>
</span><span class="bodytext">
Now we're ready to search!

</span><span class="bodytext">
<h3>Searching</h3>
</span><span class="bodytext">

</span><span class="bodytext">
<p>To search you need to put the nutch war file into your servlet
container.  (If instead of downloading a Nutch release you checked the
sources out of CVS, then you'll first need to build the war file, with
the command <tt>ant war</tt>.)</p>
</span><span class="bodytext">

Assuming you've unpacked Tomcat as ~/local/tomcat, then the Nutch war
file may be installed with the commands:
</span><span class="bodytext">
<pre style="margin-left: 40px;">rm -rf ~/local/tomcat/webapps/ROOT*
cp nutch*.war ~/local/tomcat/webapps/ROOT.war
</pre>
</span><span class="bodytext">
The webapp finds its indexes in </span><span class="bodytext"><tt>./segments</tt></span><span class="bodytext">,
relative to where you start Tomcat, so, if you've done intranet
crawling, connect to your crawl directory, or, if you've done
whole-web crawling, don't change
directories, and give the command:
</span><span class="bodytext">
<pre style="margin-left: 40px;">~/local/tomcat/bin/catalina.sh start
</pre>
</span><span class="bodytext">
Then visit </span><span class="bodytext"><a href="http://localhost:8080/">http://localhost:8080/</a></span><span class="bodytext">
and have fun!

</span>
<br class="br">
<br class="br">
</td>
</tr>
</table>
<table width="635" border="0" cellpadding="0" cellspacing="0">
  
<tr>
    
<td width="140">&nbsp;</td>
    <td width="20">&nbsp;</td>
    <td width="475" align="center">
    <span class="bodytext">
    <a href="http://creativecommons.org/licenses/by/2.0/" rel="license">
      <img src="http://creativecommons.org/images/public/somerights.gif" width="88" height="31" alt="Creative Commons License" border="0">
    </a>
    
<br>
    Except where otherwise noted, <br>this site is licensed under a <a href="http://creativecommons.org/licenses/by/2.0/">Creative Commons
    License</a>.
    <br>
      
<a href="../ca/">ca</a> |
      <a href="../de/">de</a> |
      <a href="../en/">en</a> |
      <a href="../es/">es</a> |
      <a href="../fi/">fi</a> |
      <a href="../fr/">fr</a> |
      <a href="../hu/">hu</a> |
      <a href="../jp/">jp</a> |
      <a href="../ms/">ms</a> |
      <a href="../nl/">nl</a> |
      <a href="../pl/">pl</a> |
      <a href="../pt/">pt</a> |
      <a href="../sv/">sv</a> |
      <a href="../th/">th</a> |
      <a href="../zh/">zh</a>
    
<br>
    
<a href="http://sourceforge.net"><img src="http://sourceforge.net/sflogo.php?group_id=59548" alt="sf.net" width="0" height="0" border="0"></a>
    </span>
    </td>
  
</tr>
  
<tr>
  
</tr>

</table>
</body>
</html>
